# Tools

## Table of contents
 - [Batch run](#batch-run)
 - [Cuda to Float network converter](#cuda-to-float-network-converter)
 - [Dataset builder](#dataset-builder)
 - [Network profiler](#network-profiler)
 - [Results archivier](#results-archivier)
 - [Testing video downloader](#testing-video-downloader)

## Batch run
`batchRun` allows to run serveral experiments in a row, assigning automatically new parameters to the main script. In this specific case, the 3 kernel sizes and the 3 subsampling factors take all the possible combinations ({5,7,9},{2,4})^3, for a total of 216 cases.

## Cuda to Float network converter
`netConverter` converts a `cuda` network into an equivalent `float` one.
```bash
./netConverter.lua ../results/multinet-cuda.net
```
The scripts automatically changes the extension to `-float.net` and saves the new network in the same location of the input one (which is specified as argument of the routine, as you can see from the example above).

## Dataset builder
Builds a labelled image dataset from videos. `Road-net-dataset` directory tree is the following
```
.              
├── Matlab-code
├── Videos     
├── images     
└── labels
```
### Main folders
 - [`Videos`](Road-net-dataset/Videos): where to drop videos of a specific category -- inside a category folder -- you'd like to add to the network. In this folder there is already present an `exampleFolder` category containing 4 videos, named 01 - 04 for this particular case.
 - [`Matlab-code`](Road-net-dataset/Matlab-code): contains the `vid2img` Matlab script you need to run in order to label and extract each frame. The program unpacks the selected videos into their frames, saving them into a `images` directory's subfolder, and stores the coordinates of the selected object, appearing the the videos, in a `dat` file, having the same name of the video, in a corresponding `labels` subfolder.

### Local temporary folders
 - `images`: is generated by the the `vid2img` Matlab script and contains all the frames dumped from the chosen videos
 - `labels`: contains the coordinates of the selected object within each (not skipped) frame

## Network profiler
`multinet-profiler` computes how much the training routine is computationally intense. The output is the time that the  computational unit --- CPU or GPU --- takes to process one sample, and it is given in ms (milli-seconds).  
Originally this was a test to compare CPU and GPU performances, therefore a *cuda enabled machine* is required to run this routine (otherwise, if you want to profile the network only on your CPU, comment out the part involving the GPU).

There are 3 tasks that can be performed and profiled (run `torch multinet-profiler.lua --help` for more details):
 - `CNN`: profiles the only *convolutional* network
 - `classifier`: profiles only the *linear classification* stage
 - `combined`: profiles the whole network
 
Example of running the script
```bash
torch multinet-profiler.lua --GpuId 2 --nbOfIterations 150 --task combined
```

## Results archivier
`archiveResults` moves the results and log file to a year.month.day.hour.minute folder in a default directory (which will be set soon as a command-line option), where year.month.day.hour.minute is the time-stamp of the saved network. Then it asks about removing or not the cached dataset, so that a new image size can be used for training.

To run the code, simply type
```bash
./archiveResults.lua
```

## Testing video downloader
To get some videos on which to test the demonstration script, run `getTestingVideos`. For example, to download the whole set of testing video, run the script as follows
```bash
./getTestingVideos.lua --video all
```
Otherwise, specify the name of the video or videos (use the `--help` option for getting their names) separated with a non alphanumeric character.
